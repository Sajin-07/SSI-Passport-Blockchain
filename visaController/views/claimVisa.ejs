<!DOCTYPE html>
<html lang="en" data-theme="retro">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<!-- Tailwind CSS and daisyUI -->
		<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
		<link href="https://cdn.jsdelivr.net/npm/daisyui@2.0.0/dist/full.css" rel="stylesheet">
		<title>Document</title>
	</head>
	<body>

		<nav class="bg-base-200 shadow">
			<div class="container mx-auto px-4 py-4 flex items-center justify-between">
				<a class="text-xl font-bold" href="#">Department of Visa</a>
				<div class="flex items-center gap-4">
					<label class="flex cursor-pointer gap-2 items-center">
						<!-- Sun Icon -->
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="12" cy="12" r="5" />
							<path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4" />
						</svg>
						<!-- Toggle Switch -->
						<input type="checkbox" class="toggle theme-controller" />
						<!-- Moon Icon -->
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
						</svg>
					</label>
				</div>
				<button class="lg:hidden text-gray-500">
					<span class="iconify" data-icon="heroicons-outline:menu-alt-4"></span>
				</button>
				<div class="hidden lg:flex space-x-4">
					<a href="/" class="bg-green-500 text-white py-2 px-4 rounded font-bold hover:bg-green-600">Home</a>
					<!-- Additional Links can be added here -->
				</div>
			</div>
		</nav>

        <!-- <div class="container mx-auto px-4 py-10">
            <h2 class="text-3xl font-bold border-b pb-2 mb-10">Claim Your Passport</h2>
            
            <form action="/offerCredential" method="POST" class="space-y-4">
                <label class="block text-sm font-medium">Click the Claim Button to Accept Your VC:</label>
                
                
                <input type="submit" value="Claim" class="btn btn-primary w-full">
            </form>
            <a href="/step3" class="btn btn-primary w-full mt-4">Next</a>
        </div> -->
		<div class="container mx-auto px-4 py-10">
			<h2 class="text-3xl font-bold border-b pb-2 mb-10">Claim Your Visa</h2>
		
			<form id="claimForm" class="space-y-4">
				<label class="block text-sm font-medium">Click the Claim Button to Accept Your VC:</label>
				<button type="submit" class="btn btn-primary w-full">Claim</button>
			</form>
		
			<a href="/visaStep4" class="btn btn-primary w-full mt-4">Next</a>
		</div>

		

        <% if (typeof message !== 'undefined') { %>
			<script>
				alert("<%= message %>");
			</script>
		<% } %>

		<script>
			// JavaScript for Theme Toggle
			document.addEventListener('DOMContentLoaded', function () {
				const themeController = document.querySelector('.theme-controller');
				
				// Check stored theme or default to light (bumblebee)
				const currentTheme = localStorage.getItem('theme') || 'retro';
				document.documentElement.setAttribute('data-theme', currentTheme);
				themeController.checked = currentTheme === 'synthwave';

				// Toggle event listener
				themeController.addEventListener('change', function () {
					const theme = themeController.checked ? 'synthwave' : 'retro';
					document.documentElement.setAttribute('data-theme', theme);
					localStorage.setItem('theme', theme);
				});
			});

			
			document.getElementById('claimForm').addEventListener('submit', async (event) => {
				event.preventDefault(); // Prevent default form submission behavior

				try {
					// Send a POST request to the /offerCredential API
					const response = await fetch('/offerCredential', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
						}
					});

					const result = await response.json();

					if (response.ok && result.success) {
						// Show success alert and redirect
						alert(result.message);
						window.location.href = result.redirect;
					} else if (result.redirect) {
						// Redirect to specific page (e.g., fraud or revoked)
						window.location.href = result.redirect;
					} else {
						// Handle errors
						alert(result.message || 'Failed to send credential offer. Please try again.');
					}
				} catch (error) {
					console.error('Error sending credential offer:', error);
					alert('An unexpected error occurred. Please try again.');
				}
			});
		</script>

	</body>
</html>

   